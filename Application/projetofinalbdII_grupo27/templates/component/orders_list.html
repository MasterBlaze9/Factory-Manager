{% extends 'base.html' %} {% block content %}

<div
  class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center border-bottom"
>
  <h1 class="h2">Lista de encomendas</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="">
      <a
        class="btn btn-primary my-4 float-end"
        data-bs-toggle="modal"
        data-bs-target="#exportOrdersModal"
        >Exportar encomendas</a
      >
    </div>
  </div>
</div>
<div class="pt-md-3">
  <table id="table-orders" class="table table-striped" style="width: 100%">
    <thead>
      <tr>
        <th>Encomenda</th>
        <th>Preço</th>
        <th>Encomendado por</th>
        <th>Estado</th>
        <th>Data</th>
        <th class="no-sort">Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for row in view_data %}
      <tr>
        <td>{{ row.1 }}</td>
        <td>{{ row.2|default:"-" }}€</td>
        <td>{{ row.4.strip|default:"-" }}</td>
        {% if row.5 == 'Por entregar' %}
        <td class="text-danger">{{ row.5.strip|default:"-" }}</td>
        {% elif row.5 == 'Parcialmente entregue' %}
        <td class="text-warning">{{ row.5.strip|default:"-" }}</td>
        {% else %}
        <td class="text-success">{{ row.5.strip|default:"-" }}</td>
        {% endif %}
        <td>{{ row.3|date:'d-m-Y'|default:"-" }}</td>
        <td>
          <a class="btn btn-primary" href="{% url 'order_detail' row.0 %}"
            >Visualizar detalhes</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div
  class="modal fade"
  id="exportOrdersModal"
  tabindex="-1"
  aria-labelledby="exportOrdersModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exportOrdersModalLabel">
          Exportar encomendas
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <form
        method="post"
        action="{% url 'handle_export_orders' %}"
        enctype="multipart/form-data"
      >
        <div class="modal-body">
          <div class="">
            {% csrf_token %}
            <label for="exportOrdersFileInput" class="form-label"
              >Selecionar tipo de ficheiro a exportar</label
            >
            <div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="inlineRadioExportExtension"
                  id="inlineRadioExport_JSON"
                  checked
                  value="JSON"
                />
                <label class="form-check-label" for="inlineRadioExport_JSON"
                  >JSON</label
                >
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="inlineRadioExportExtension"
                  id="inlineRadioExport_XML"
                  value="XML"
                />
                <label class="form-check-label" for="inlineRadioExport_XML"
                  >XML</label
                >
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <input
            class="btn btn-success float-end"
            type="submit"
            value="Exportar"
          />
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  $(document).ready(function () {
    $("#table-orders").DataTable({
      language: {
        url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/pt-PT.json"
      },
      columnDefs: [
        {
          targets: "no-sort",
          orderable: false
        }
      ]
    });
  });
</script>
{% endblock %}
